# 「はじめて読む486」のメモ

486の原型は8086

3つの動作モードがある
* リアルモード
* プロテクトモード
* 仮想8086モード

リアルモードは、8086と(一部の例外を除き)全く同じ動作をする

ブート時はリアルモード

プロテクトモードでは、CPUの拡張機能を使ってメモリ管理やタスク管理を行うことができる

リアルモードとプロテクトモードは独立しているが、仮想8086モードでは拡張機能を使いつつ8086のアプリケーションを実行できる

## 32bit

### 8086の２つの壁
#### 64Kバイトの壁
アドレスを指定するのに16bitの値を使うため、連続して扱える領域は64KB(0〜65535)

例えば、
```
char *buf;
buf = (char*)malloc(100000);
```
とかはできない。

#### 640Kバイトの壁
アドレスを20bitで表現しているため、アドレス空間が1MBしかとれない

### 32bitのパワー
連続した領域の最大バイト数までの領域を扱える
さらに、仮想記憶を使えばディスクの残り容量分までの領域を扱える

## 様々なCPU
CPUはCISCとRISCに分類できる。486はCISCの86系(8086ベース)

| CPU | 				特徴				 |
|:---:|:------------------------------------:|
| 8086| 8080からの移行.16bit.86系のベース	 |
| 286 | プロテクトモードの導入				 |
| 386 | 86系初の32bit,仮想8086,ページング	 |

## 486
486の基本形は486DX

486の性能向上の最も大きな要因はキャッシュメモリ(これは河合さんも言ってた)

### キャッシュメモリ
CPUのクロックはとても高速だが、メモリアクセスは(それに比べると)とても遅い。
そのため、いったんアクセスしたデータは高速なキャッシュメモリに一時的に溜め込んでおいて、同じアドレスへのメモリアクセスがあればキャッシュメモリのデータを利用する。
486のキャッシュメモリは8KB <- 高速な代わりに、あまり大きくは出来ない

* ライトスルー方式
キャッシュに保持されているアドレスのメモリへの書き込みがあると、キャッシュメモリと本来のメモリ両方への書き込みを行う

* ライトバック方式
とりあえずキャッシュメモリに書き込んでおいて、別のタイミングで本来のメモリと同期する。
高速な代わり一貫性を保つのが難しい。

### クロックダブラー
486DX2/ODPで使われた高速化の技術。
CPUのクロック数だけシステム全体のクロック数より高速(2倍)にすることで、CPU内での演算処理を高速に実行する。
メモリアクセスは遅いままだが、キャッシュにヒットしていれば高速に実行を続けられる。

### クロックトリプラー
CPUのクロック数3倍

## 486の命令

### 一般命令
データ転送、四則演算、条件分岐
通常のアプリケーションが使うのは一般命令だけ

### 特殊命令
システムレジスタへのアクセス
プロテクトモードのメモリ管理やタスク管理の設定など

## 486のレジスタ

### 一般レジスタ
例のごとく命名規則はは"Extend" + 下位16bitのレジスタ名
セグメントレジスタ以外は32bitに拡張
FS,GSが追加

### 浮動小数点レジスタ

### システムレジスタ
GDTR,IDTR
LDTR,TR
CR0〜CR3

### デバッグレジスタ
初めて聞いた。デバッガで利用する。
ブレークポイントの設定が出来る。

DR0 : break point addr 0
DR1 : break point addr 1
DR2 : break point addr 2
DR3 : break point addr 3
DR4 : reserved
DR5 : reserved
DR6 : ステータス
DR7 : デバッグコントロール

あと、テストレジスタ(TR3〜TR7)というのもあるらしい。


